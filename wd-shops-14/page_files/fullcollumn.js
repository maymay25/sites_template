function footerinit(){footerdrag();footerresize();$.showSiteFooterTips();$(".full_column").each(function(){fullcolumninit($(this))})}function fullcolumninit(A){A.children(".full_width").css({left:0-canv.offset().left-$.parseInteger($("#canvas").css("borderLeftWidth")),width:$("#scroll_container_bg").width()});A.wp_rightkey();if(A.is(":not(.isplate)")){fullcolumndrag(A);fullcolumnresize(A);fullcolumndrop(A)}}function footerdrag(){var B=0;var D=canv.height();var C=Undo.Command.createModuleCommand(function(F,G){var E=$("#"+F);E.css("top",G.top);canv.height(G.canvheight);$("#scroll_container_bg").css("height",(G.canvheight+E.height())+"px");$.updateselectbgopt();$.updatepospropblk();$.canvasHeightChange()},null,{returntype:"class"});var A=null;$("#site_footer").draggable({cursor:"move",axis:"y",start:function(F,E){initCanvasHeight();var G=canv.data("layermaxheight")||0;D=canv.height();B=D-G;A=new C("site_footer");A.setOldVal({top:$.parseInteger($(this).css("top")),canvheight:D})},drag:function(G,F){var I=F.position.top-F.originalPosition.top;if(I<0){var H=0-I;if(H>B){var E=canv.data("layermaxheight")||0;F.position.top=F.originalPosition.top-B;canv.height(E);$("#scroll_container_bg").css("height",(E+$(this).height()+100)+"px");$.showselectbgopt($(this));$(this).triggerHandler("drag_progress",[{left:0,top:F.position.top}]);return}}$(this).triggerHandler("drag_progress",[{left:0,top:F.position.top}]);canv.height(D+I);$.showselectbgopt($(this));$("#scroll_container_bg").css("height",(D+I+$(this).height()+100)+"px")},stop:function(F,E){var G=E.position.top-E.originalPosition.top;canv.height(D+G);$("#scroll_container_bg").css("height",(D+G+$(this).height()+100)+"px");$.canvasHeightChange();correctFooterPos();A.insertWithNewVal({top:$.parseInteger($(this).css("top")),canvheight:D+G});A=null;$(this).trigger("drag_stop",[{left:parseInt($(this).css("left")),top:parseInt($(this).css("top"))}])}})}function fullcolumndrag(A){A.wp_drag()}function fullcolumnresize(C){var D=function(E){C.each(function(){var F="ui-resizable-"+E;var G=$('<div class="ui-resizable-handle '+F+'"><p class="knob "></p></div>');G.css({zIndex:1000});$(this).children(".full_width").append(G)})};var B=function(E){C.each(function(){var F="placeholder-"+E;var G=$('<div class="li-placeholder  '+F+'"></div>');G.css({zIndex:1000}).hide();$(this).children(".full_width").append(G)})};D("n");D("s");B("w");B("e");var A;C.resizable({handles:{n:">.full_width .ui-resizable-n",s:">.full_width .ui-resizable-s"},noinit:true,canvascontain:"#canvas",distance:0,concernLock:true,create:function(){$(this).children(".full_width").find(".ui-resizable-handle").hide()},start:function(H,G){A=$.getFullColChildMaxButtom(C);var I=$(this);var K=new ResizeCommand(I.attr("id"));var E=["top","height"];var J={};for(var F=0;F<E.length;F++){J[E[F]]=I.css(E[F])}K.setOldVal(J);$(document).data("resizeundo",K)},resize:function(G,F){var H=C.ab_pos_cnter("top");var I=$.parseInteger(C.css("height"));if($.getElementAreaInf($(this))=="canvas"){var E=Math.max(H+A,H+I);$.canvasheightresizeOrigin(E)}$(this).children(".full_content,.full_width").height($(this).height());$(this).triggerHandler("resize_progress",[{ui:F}]);$.showselectbgopt($(this))},stop:function(I,H){$(this).children(".full_content,.full_width").height($(this).height());$.showselectbgopt($(this));var K=$(document).data("resizeundo");$(document).removeData("resizeundo");var J=$(this);var E=["top","height"];var F={};for(var G=0;G<E.length;G++){F[E[G]]=J.css(E[G])}$(this).triggerHandler("resize_stop",[{ui:H}]);K.insertWithNewVal(F)}})}function footerresize(){var F=function(K){var I="ui-resizable-"+K;var J=$('<div class="ui-resizable-handle '+I+'"><p class="knob "></p></div>');J.css({zIndex:1000});$("#site_footer >.full_width").append(J)};var E=function(K){var I="placeholder-"+K;var J=$('<div class="li-placeholder  '+I+'"></div>');J.css({zIndex:1000});$("#site_footer> .full_width").append(J)};F("n");F("s");E("w");E("e");var G=0;var D=canv.height();var H=0;var C=Undo.Command.createModuleCommand(function(J,K){var I=$("#"+J);I.css("top",K.top);I.css("height",K.height);canv.height(K.canvheight);I.children(".full_content,.full_width").height(K.height);$("#scroll_container_bg").css("height",(K.canvheight+I.height())+"px");$.updateselectbgopt();$.updatepospropblk();$.canvasHeightChange()},null,{returntype:"class"});var A=null;var B=null;$("#site_footer").resizable({handles:{n:">.full_width .ui-resizable-n",s:">.full_width .ui-resizable-s"},noinit:true,distance:0,create:function(){$(this).children(".full_width").find(".ui-resizable-handle").hide()},start:function(J,I){initCanvasHeight();if(B){clearTimeout(B);B=null}H=canv.data("layermaxheight")||0;D=canv.height();G=D-H;A=new C("site_footer");A.setOldVal({top:$.parseInteger($(this).css("top")),canvheight:D,height:$(this).height()});$(this).triggerHandler("resize_progress",[{ui:I}])},resize:function(L,K){var M=$(this).data("resizable");var N=M.axis;if(N=="n"){var I=$(this).height()-K.originalSize.height;if(I>G){var J=H;$(this).css({top:J,height:K.originalSize.height+G});$(this).children(".full_content,.full_width").height($(this).height());canv.height(H);$("#scroll_container_bg").css("height",(H+$(this).height()+100)+"px");$.showselectbgopt($(this));return}canv.height(D-I);$(this).children(".full_content,.full_width").height($(this).height());$("#scroll_container_bg").css("height",(canv.height()+$(this).height()+100)+"px")}else{$(this).children(".full_content,.full_width").height($(this).height());$("#scroll_container_bg").css("height",(canv.height()+$(this).height()+100)+"px")}$.showselectbgopt($(this));$(this).triggerHandler("resize_stop",[{ui:K}])},stop:function(J,I){var K=$(this);A.insertWithNewVal({top:$.parseInteger(K.css("top")),canvheight:canv.height(),height:K.height()});A=null;$.canvasHeightChange()}})}function fullcolumndrop(B){var A=function(D){B.each(function(){var E="placeholder-"+D;var F=$('<div class="li-placeholder  '+E+'"></div>');F.css({zIndex:1000});$(this).children(".full_content").append(F)})};A("n");A("s");A("w");A("e");var C=B.children(".full_content");C.children(".li-placeholder").hide();C.children(".placeholder-n").css({"border-top":"#FF9900 dashed 4px"});C.children(".placeholder-s").css({"border-bottom":"#FF9900 dashed 4px"});C.children(".placeholder-e").css({"border-right":"#FF9900 dashed 4px"});C.children(".placeholder-w").css({"border-left":"#FF9900 dashed 4px"});C.droppable({tolerance:"pointer",accept:".full_column,.cstlayer",drop:function(E,D){var F=$.ui.ddmanager.current;if($.getElementAreaInf($(F.element))==$.getElementAreaInf(B)){if(!B.hasClass("ui-modselected")){$(this).children(".li-placeholder").hide();var G=$(document).data("layer_final_drop_id");var H=$.chooseBiggerColumn(G,B.attr("id"));$(document).data("layer_final_drop_id",H)}}},over:function(N,I){var F=false;$(".ui-modselected").each(function(){if($(this).data("cstlayerstatus")=="unlock"){F=true}});if(F){return}var K=$.ui.ddmanager.current;if($.getElementAreaInf($(K.element))==$.getElementAreaInf(B)){if(!B.hasClass("ui-modselected")){var H=B.attr("id");var M=$(document).data("layer_drop_over_id");if(H!=M){var L=$.chooseBiggerColumn(M,H);if(L==H){var D=$(this);$(this).children(".li-placeholder").show();if(M){var G=$("#"+M);var E=G.children(".full_content").data("droppable");E["isover"]=0;E["isout"]=1;E._out.call(E,N)}$(document).data("layer_drop_over_id",H)}else{var J=$(this).data("droppable");J["isover"]=0;J["isout"]=1}}}}},out:function(F,E){var G=false;$(".ui-modselected").each(function(){if($(this).data("cstlayerstatus")=="unlock"){G=true}});if(G){return}var H=$.ui.ddmanager.current;if($.getElementAreaInf($(H.element))==$.getElementAreaInf(B)){if(!B.hasClass("ui-modselected")){$(this).children(".li-placeholder").hide();var D=$(document).data("layer_drop_over_id");if(D==B.attr("id")){$(document).removeData("layer_drop_over_id")}}}}})}function fullcolumn_propblk_init(){var B;for(var A in $.backgroundPropDefaults){(function(){var C=A;var D=null;if($.inArray(C,["bg_moveto_prevop","bg_moveto_nextop"])!=-1){var E="",F="";switch(C){case"bg_moveto_prevop":F="top";E='<div class="wp-moveto_fstlevel"><a class="property-bar-top" href="###" title="'+translate("Move to top")+'"><span>&nbsp;</span></a></div>';break;case"bg_moveto_nextop":F="bottom";E='<div class="wp-moveto_lstlevel"><a class="property-bar-bottom" href="###" title="'+translate("Move to bottom")+'"><span>&nbsp;</span></a></div>';break}D={mousedown:function(){var G=$(this);var I=G.offset();var H=$("#scroll_container");var J=H.scrollTop();$(E).appendTo(H).css({top:function(){return(I.top+J-25-39)+"px"},left:I.left+"px"}).click(function(K){$("#"+$.bgselectedid).wp_setorder(F,$.bgselectedid);$(this).remove();G.removeClass("local");K.preventDefault()})},mouseup:function(){}}}$("#"+C).mousedown(function(H){var G=$(this);G.addClass("local");if($(".wp-moveto_fstlevel,.wp-moveto_lstlevel").size()){$(".wp-moveto_fstlevel,.wp-moveto_lstlevel").remove()}if(D!=null){D.mousedown.apply(this)}H.preventDefault()}).mouseup(function(I){var H=this,G=$(H);G.removeClass("local");$.backgroundPropDefaults[C].apply(this);if(D!=null){D.mouseup.apply(this)}I.preventDefault()})})()}}(function(A){function B(D){var F={};F[D.prop("id")]="null";var C=D;while(true){var E=A.getElementFatherid(C);if(E=="none"){break}F[E]=C.prop("id");C=A("#"+E)}return F}A.chooseBiggerColumn=function(E,F){var K=F;if(E==F){return K}if(E){var N=A("#"+E);var G=A("#"+F);var H=B(N);var M=B(G);var L="canvas";if(!H[L]){L="site_footer"}var C=L;var J=L;while(C==J){C=H[C];J=M[J];if(C=="null"||J=="null"){break}}if(C=="null"){K=F}else{if(J=="null"){K=E}else{var I=A.parseInteger(A("#"+C).css("z-index"));var D=A.parseInteger(A("#"+J).css("z-index"));if(I>D){K=E}}}}return K};A.transferToColumn=function(F,C){var I=A.getElementFatherid(F);if(I!=C){var H=A("#"+C);var D=F.ab_pos("top");var G=H.ab_pos("top");var E=H;if(C!="canvas"){E=H.children(".full_content")}F.detach().attr("fatherid",C).css("top",(D-G)).appendTo(E);if(C=="site_footer"||C=="canvas"){F.removeAttr("fatherid")}}};A.getElementAreaInf=function(C){return C.attr("inbuttom")=="1"?"site_footer":"canvas"};A.transferToArea=function(J,E,I,G){var D=J.ab_pos("top");var F=A.parseInteger(A("#site_footer").css("top"));if(I=="site_footer"){var C=D-F;J.css("top",C);J.attr("inbuttom","1");J.detach().removeAttr("fatherid").appendTo(A("#site_footer").children(".full_content"));if(J.hasClass("full_column")){J.find(".cstlayer,.full_column").attr("inbuttom","1")}}else{var C=D+F;J.css("top",C);var H=A("#canvas").height();if(H<C+J.height()&&!G){A.canvasheightresizeOrigin(C+J.height())}J.removeAttr("inbuttom");J.detach().removeAttr("fatherid").appendTo(A("#canvas"));if(J.hasClass("full_column")){J.find(".cstlayer,.full_column").removeAttr("inbuttom")}}if(J.is(".ui-modselected")){A.hidWidgetBorder(J);A.showWidgetBorder(J)}if(J.is(".full_column")){J.find(".cstlayer,.full_column").each(function(){if(A(this).is(".ui-modselected")){A.hidWidgetBorder(A(this));A.showWidgetBorder(A(this))}})}};A.addFullColumn=function(C){var D=function(K,J){var F=K;if(J){var E=A(F).filter(".full_column");var H=E.prop("id");var I="layer"+fGuid();F=F.replace(new RegExp(H,"g"),I)}var G=A(F).appendTo("#canvas").css("top",C);G=G.filter(".full_column");fullcolumninit(G);G.css("z-index",G.wp_setorder("add",G.prop("id")));A(".ui-modselected").each(function(){A.hidWidgetBorder(A(this));if(A(this).hasClass("graphic_edited")){actived_graphic()}});A.selectbgdiv(G);new AddCommand(G.prop("id")).insert()};if(A.addFullColumn.html_cache){D(A.addFullColumn.html_cache,true);return}A.ajax({type:"GET",url:parseToURL("wp_widgets","gtfullcolumn"),success:function(E){A.addFullColumn.html_cache=E;D(E,false)},error:function(G,E,F){wp_alert((F||E)+"(add a fullcolumn).<br/>"+translate("Request failed!"));return false}})};A.curSelectableFather=function(){var C=A(".ui-modselected");if(C.length==0){A(document).data("cur_selectable_father",null);return null}else{var D=A.getElementFatherid(C.filter(":first"));A(document).data("cur_selectable_father",D);return D}};A.getElementFatherid=function(C){if(C.prop("id")=="canvas"||C.prop("id")=="site_footer"){return"none"}var D=C.attr("fatherid");if(!D||D==""){if(C.closest("#canvas").length>0){D="canvas"}else{if(C.closest("#site_footer").length>0){D="site_footer"}}}return D};A.fn.ab_pos=function(D){var C=A(this);if(C.prop("id")=="canvas"||C.prop("id")=="site_footer"){return 0}if(D=="left"||D=="top"){if(!C.attr("fatherid")||C.attr("fatherid")==""){return C.rel_pos(D)}return C.rel_pos(D)+A("#"+C.attr("fatherid")).ab_pos(D)}};A.fn.ab_pos_cnter=function(D){var C=A(this).ab_pos(D);if(A(this).closest("#site_footer").length>0&&D=="top"){return C+A.parseInteger(A("#site_footer").css(D))}return C};A.fn.rel_pos=function(C){if(C=="left"||C=="top"){return A.parseInteger(A(this).css(C))}};A.getFullColChildMaxButtom=function(D){var C=D.ab_pos_cnter("top");var E=C;D.find(".cstlayer,.full_column").each(function(){var F=A(this);var G=0;if(F.hasClass("cstlayer")){G=A.divrotate.getDegreeModMaxPoint(F,null,"buttom")}else{G=F.ab_pos_cnter("top")+A.parseInteger(F.css("height"))}if(E<G){E=G}});return E-C};A.getFullColumnButtomPos=function(C){if(C.hasClass("cstlayer")){return A.divrotate.getDegreeModMaxPoint(C,null,"buttom")}else{if(C.hasClass("full_column")){var D=0;C.find(".cstlayer,.full_column").andSelf().each(function(){var E=A(this);var F=0;if(E.hasClass("cstlayer")){F=A.divrotate.getDegreeModMaxPoint(E,null,"buttom")}else{F=E.ab_pos_cnter("top")+A.parseInteger(E.css("height"))}if(D<F){D=F}});return D}}};A.saveFullColumnObj=function(G){var C=G.children(".full_width").data("backgroundprops")||{};var D=G.find(".full_content").data("backgroundprops")||{};var F=G.height();var E={};if(G.prop("id")!="site_footer"){E={top:A.parseInteger(G.css("top")),zindex:A.parseInteger(G.css("z-index")),lock:G.data("cstlayerstatus")}}return A.extend({fullbackgroundprop:C,contentbackgroundprop:D,footerheight:F},E)}})(jQuery);